<!DOCTYPE html>
<html>
<head>
    <title>Update Lead</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
            font-family: "Inter", sans-serif;
            color: #2c3e50;
        }

        /* Center wrapper */
        .content-wrapper {
            max-width: 900px;
            margin: auto;
        }

        /* Top Bar */
        .top-bar {
            background: #ffffff;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* Form and follow-up layout */
        .form-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-box {
            background: #ffffff;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.06);
            flex: 2; /* Form wider than follow-ups */
        }

        .followups-box {
            background: #ffffff;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.06);
            flex: 1; /* Smaller panel for follow-ups */
            max-height: 400px;
            overflow-y: auto;
        }

        .form-box h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        /* Buttons */
        .btn-sm {
            font-size: 14px;
            padding: 4px 10px;
        }

        /* Disabled buttons */
        .btn-disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Follow-up list styling */
        .list-group-item {
            font-size: 14px;
        }
    </style>
</head>

<body>
<div class="mt-3 content-wrapper">

    <!-- Top Bar -->
    <nav class="top-bar">
        <div class="d-flex gap-2">
                <!--<a href="{% url 'lead_create' %}" class="btn btn-success btn-sm">Create Lead</a>-->
                <a href="{% url 'lead_list' %}" class="btn btn-primary btn-sm">Leads</a>
        </div>

        <div class="d-flex gap-2">
            {{ request.user.username }}
            <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary btn-sm">Dashboard</a>
            <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">Logout</a>
        </div>
    </nav>

    <!-- Form + Follow-ups Layout -->
    <div class="form-container">
        <!-- Update Lead Form -->
        <div class="form-box">
            <h3>Update Lead</h3>
            <form method="POST">
                {% csrf_token %}

                <label>Name:</label>
                <input type="text" name="name" value="{{ lead.name }}" class="form-control mb-3" required>

                <label>Email:</label>
                <input type="email" name="email" value="{{ lead.email }}" class="form-control mb-3" required>

                <label>Phone:</label>
                <input type="text" name="phone" value="{{ lead.phone }}" class="form-control mb-3">

                <label>Status:</label>
                <select name="status" class="form-select mb-3" required>
                    <option value="new" {% if lead.status == "new" %}selected{% endif %}>New</option>
                    <option value="in_progress" {% if lead.status == "in_progress" %}selected{% endif %}>In Progress</option>
                    <option value="converted" {% if lead.status == "converted" %}selected{% endif %}>Converted</option>
                    <option value="lost" {% if lead.status == "lost" %}selected{% endif %}>Lost</option>
                </select>
                
                <textarea name="comment" class="form-control mb-3" placeholder="Enter follow-up notes here..."></textarea>

                <button type="submit" class="btn btn-primary">Update Lead</button>
                <a href="{% url 'lead_list' %}" class="btn btn-secondary ms-2">Cancel</a>
            </form>
        </div>

        <!-- Previous Follow-ups Panel -->
        <div class="followups-box">
            <h5>Previous Follow-ups:</h5>
            {% if followups %}
                <ul class="list-group">
                    {% for f in followups %}
                        <li class="list-group-item">
                            <strong>{{ f.user.username }}</strong> ({{ f.created_at|date:"Y-m-d H:i" }}):<br>
                            {{ f.comment }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No previous follow-ups.</p>
            {% endif %}
        </div>
    </div>

</div>

<!-- TOAST MESSAGES -->
<div class="position-fixed top-0 end-0 p-3" style="z-index:1100">
    {% if messages %}
        {% for message in messages %}
            <div class="toast align-items-center
                {% if message.tags == 'error' %}text-bg-danger
                {% elif message.tags == 'success' %}text-bg-success
                {% elif message.tags == 'warning' %}text-bg-warning
                {% else %}text-bg-info{% endif %}
                border-0 mb-2" role="alert">

                <div class="d-flex">
                    <div class="toast-body">{{ message }}</div>
                    <button type="button"
                            class="btn-close btn-close-white me-2 m-auto"
                            data-bs-dismiss="toast"></button>
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var toastElList = [].slice.call(document.querySelectorAll('.toast'));
        toastElList.map(function (toastEl) {
            var bsToast = new bootstrap.Toast(toastEl, { delay: 4000 });
            bsToast.show();
            return bsToast;
        });
    });
</script>

</body>
</html>
