<!DOCTYPE html>
<html>
<head>
    <title>All Leads</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
            font-family: "Inter", sans-serif;
            color: #2c3e50;
        }

        /* Centered container for top bar, search bar, table */
        .content-wrapper {
            max-width: 900px;
            margin: auto;
        }

        /* Top Bar */
        .top-bar {
            background: #ffffff;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* Search Bar */
        .search-bar {
            background: #ffffff;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.06);
            margin-bottom: 12px;
            font-size: 14px;
        }

        .table-box {
            background: #ffffff;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.06);
            overflow-x: auto;
            text-align: center;
        }

        table.table {
            width: 100%;
            table-layout: fixed; /* Fix column widths */
            font-size: 14px;
        }

        table.table td, table.table th {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 6px 8px;
        }

        /* Pagination */
        .pagination-sticky {
            position: sticky;
            top: 8px;
            background: #f4f6f9;
            z-index: 10;
            padding: 8px 0;
        }

        .btn-disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Action icons */
        .action-icons a {
            font-size: 16px;
            margin-right: 6px;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s, color 0.2s;
        }

        .action-icons a:hover {
            transform: scale(1.3);
        }

        .action-icons a[title="Edit"]:hover { color: #0d6efd; }
        .action-icons a[title="Delete"]:hover { color: #dc3545; }

        /* Table row hover */
        table.table tbody tr:hover {
            background-color: #f1f5f9;
        }
    </style>
</head>

<body class="mt-3">

<div class="content-wrapper">

    <!-- TOP MENU BAR -->
    <nav class="top-bar">
        <div class="d-flex gap-1">
            <a href="{% url 'lead_create' %}" class="btn btn-success btn-sm">Create Lead</a>
        </div>
        <div>
            {{request.user.username}}
            <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary btn-sm">Dashboard</a>
            <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">Logout</a>
        </div>
    </nav>

    <h2 class="text-center mb-2">All Leads</h2>

    <!-- SEARCH BAR -->
    <div class="search-bar">
        <form method="GET" class="row g-2">
            <div class="col-md-5">
                <input type="search" name="q" value="{{ query }}" placeholder="Search by name, email, or phone" class="form-control form-control-sm">
            </div>
            <div class="col-md-3">
                <select name="status" class="form-select form-select-sm">
                    <option value="">All Statuses</option>
                    <option value="new" {% if status == "new" %}selected{% endif %}>New</option>
                    <option value="in_progress" {% if status == "in_progress" %}selected{% endif %}>In Progress</option>
                    <option value="converted" {% if status == "converted" %}selected{% endif %}>Converted</option>
                    <option value="lost" {% if status == "lost" %}selected{% endif %}>Lost</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100 btn-sm">Filter</button>
            </div>
        </form>
    </div>

    <!-- PAGINATION ABOVE -->
    <nav aria-label="Page navigation" class="pagination-sticky mb-2">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?q={{ query }}&status={{ status }}&page={{ page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?q={{ query }}&status={{ status }}&page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?q={{ query }}&status={{ status }}&page={{ page_obj.next_page_number }}">Next</a></li>
            {% endif %}
        </ul>
    </nav>

    <!-- LEAD TABLE -->
    <div class="table-box">
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <!-- Assigned To column is hidden until required -->
                    <!-- <th>Assigned To</th> -->
                    <!--<th>Actions</th>   -->
                    <th>Update | Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in page_obj %}
                    <tr>
                        <td>{{ lead.name }}</td>
                        <td>{{ lead.email }}</td>
                        <td>{{ lead.phone }}</td>
                        <td>
                            {% if lead.status == 'new' %}
                                <span class="badge bg-primary">New</span>
                            {% elif lead.status == 'in_progress' %}
                                <span class="badge bg-warning text-dark">In Progress</span>
                            {% elif lead.status == 'converted' %}
                                <span class="badge bg-success">Converted</span>
                            {% elif lead.status == 'lost' %}
                                <span class="badge bg-danger">Lost</span>
                            {% endif %}
                        </td>
                        <!-- Assigned To is hidden -->
                        <!-- <td>{{ lead.assigned_to }}</td> -->
                        <td>
                        
                                <div class="action-icons">
                                    <span style="color: white;">----</span>
                                    <a href="{% url 'lead_update' lead.pk %}" title="Edit">‚úèÔ∏è</a>
                                    <span style="color: white;">----</span>
                                    <a href="{% url 'lead_delete' lead.pk %}" title="Delete">üóëÔ∏è</a>
                                </div>
                            
                                <!--<span class="text-muted">No permission</span> -->
                        
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">No leads found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- PAGINATION BELOW -->
    <nav aria-label="Page navigation" class="mt-3">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?q={{ query }}&status={{ status }}&page={{ page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?q={{ query }}&status={{ status }}&page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?q={{ query }}&status={{ status }}&page={{ page_obj.next_page_number }}">Next</a></li>
            {% endif %}
        </ul>
    </nav>

</div> <!-- content-wrapper -->

<!-- TOAST MESSAGES -->
<div class="position-fixed top-0 end-0 p-3" style="z-index:1100">
    {% if messages %}
        {% for message in messages %}
            <div class="toast align-items-center
                {% if message.tags == 'error' %}text-bg-danger
                {% elif message.tags == 'success' %}text-bg-success
                {% elif message.tags == 'warning' %}text-bg-warning
                {% else %}text-bg-info{% endif %}
                border-0 mb-2" role="alert">

                <div class="d-flex">
                    <div class="toast-body">{{ message }}</div>
                    <button type="button"
                            class="btn-close btn-close-white me-2 m-auto"
                            data-bs-dismiss="toast"></button>
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- TOAST INITIALIZATION -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.toast').forEach(function (toastEl) {
            new bootstrap.Toast(toastEl, { delay: 4000 }).show();
        });
    });
</script>

</body>
</html>
